<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Vue源码解析," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="补充事件改一下例子 main.js 12345678910111213141516171819202122232425262728import Vue from &apos;vue&apos;import App from &apos;./App&apos;;Vue.config.productionTip = false/* eslint-disable no-new */new Vue(&amp;#123;  el: &apos;#app&apos;,  da">
<meta name="keywords" content="Vue源码解析">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue源码解析（7）- 补充">
<meta property="og:url" content="http://yoursite.com/2019/09/08/Vue源码解析（7）-补充/index.html">
<meta property="og:site_name" content="渣渣大星星的学习笔记">
<meta property="og:description" content="补充事件改一下例子 main.js 12345678910111213141516171819202122232425262728import Vue from &apos;vue&apos;import App from &apos;./App&apos;;Vue.config.productionTip = false/* eslint-disable no-new */new Vue(&amp;#123;  el: &apos;#app&apos;,  da">
<meta property="og:locale" content="default">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-230735@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-232213@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-125550@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-125619@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-133025@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-133856@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-145809@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-151133@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-151217@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-151354@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-151541@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-165247@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-165937@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-170314@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-171130@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-222530@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-222753@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-151714@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-151816@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-152105@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-161250@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-161533@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-165558@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-171617@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-174914@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-172113@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-175418@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-180033@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-185324@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-185653@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-185841@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190906-190059@2x.png">
<meta property="og:image" content="ttp://www.qinhanwen.xyz/WX20190907-123004@2x.png">
<meta property="og:updated_time" content="2019-09-08T14:12:29.418Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Vue源码解析（7）- 补充">
<meta name="twitter:description" content="补充事件改一下例子 main.js 12345678910111213141516171819202122232425262728import Vue from &apos;vue&apos;import App from &apos;./App&apos;;Vue.config.productionTip = false/* eslint-disable no-new */new Vue(&amp;#123;  el: &apos;#app&apos;,  da">
<meta name="twitter:image" content="ttp://www.qinhanwen.xyz/WX20190906-230735@2x.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/09/08/Vue源码解析（7）-补充/"/>





  <title>Vue源码解析（7）- 补充 | 渣渣大星星的学习笔记</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">渣渣大星星的学习笔记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/index.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/index.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/index.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/08/Vue源码解析（7）-补充/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="秦瀚文">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="渣渣大星星的学习笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Vue源码解析（7）- 补充</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-08T14:23:31+08:00">
                2019-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Vue源码解析/" itemprop="url" rel="index">
                    <span itemprop="name">Vue源码解析</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p>改一下例子</p>
<p>main.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span>;</span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* eslint-disable no-new */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      message: <span class="string">"123"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    App</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    clickHandler() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Child clicked!'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    selectHandler() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Child select!'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  template: <span class="string">`&lt;div&gt; </span></span><br><span class="line"><span class="string">  &lt;App @select="selectHandler" @click.native.prevent="clickHandler" /&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;`</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>App.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button @click=&quot;clickHandler($event)&quot;&gt;click me&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;App&quot;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    firstName: String</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    clickHandler(e) &#123;</span><br><span class="line">      console.log(&quot;Button clicked!&quot;, e);</span><br><span class="line">      this.$emit(&quot;select&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>从<code>var code = ast ? genElement(ast, state) : &#39;_c(&quot;div&quot;)&#39;;</code>开始，先看生成的<code>ast</code>，进入<code>genElement</code>方法</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-230735@2x.png" alt="WX20190906-230735@2x"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  ast,</span></span></span><br><span class="line"><span class="function"><span class="params">  options</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> state = <span class="keyword">new</span> CodegenState(options);</span><br><span class="line">  <span class="keyword">var</span> code = ast ? genElement(ast, state) : <span class="string">'_c("div")'</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    render: (<span class="string">"with(this)&#123;return "</span> + code + <span class="string">"&#125;"</span>),</span><br><span class="line">    staticRenderFns: state.staticRenderFns</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>进入<code>genElement</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genElement</span> (<span class="params">el, state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (el.parent) &#123;</span><br><span class="line">    el.pre = el.pre || el.parent.pre;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (el.staticRoot &amp;&amp; !el.staticProcessed) &#123;</span><br><span class="line">    <span class="keyword">return</span> genStatic(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.once &amp;&amp; !el.onceProcessed) &#123;</span><br><span class="line">    <span class="keyword">return</span> genOnce(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.for &amp;&amp; !el.forProcessed) &#123;</span><br><span class="line">    <span class="keyword">return</span> genFor(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.if &amp;&amp; !el.ifProcessed) &#123;</span><br><span class="line">    <span class="keyword">return</span> genIf(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.tag === <span class="string">'template'</span> &amp;&amp; !el.slotTarget &amp;&amp; !state.pre) &#123;</span><br><span class="line">    <span class="keyword">return</span> genChildren(el, state) || <span class="string">'void 0'</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.tag === <span class="string">'slot'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> genSlot(el, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// component or element</span></span><br><span class="line">    <span class="keyword">var</span> code;</span><br><span class="line">    <span class="keyword">if</span> (el.component) &#123;</span><br><span class="line">      code = genComponent(el.component, el, state);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> data;</span><br><span class="line">      <span class="keyword">if</span> (!el.plain || (el.pre &amp;&amp; state.maybeComponent(el))) &#123;</span><br><span class="line">        data = genData$<span class="number">2</span>(el, state);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> children = el.inlineTemplate ? <span class="literal">null</span> : genChildren(el, state, <span class="literal">true</span>);</span><br><span class="line">      code = <span class="string">"_c('"</span> + (el.tag) + <span class="string">"'"</span> + (data ? (<span class="string">","</span> + data) : <span class="string">''</span>) + (children ? (<span class="string">","</span> + children) : <span class="string">''</span>) + <span class="string">")"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// module transforms</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; state.transforms.length; i++) &#123;</span><br><span class="line">      code = state.transforms[i](el, code);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>进入<code>genChildren</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genChildren</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  el,</span></span></span><br><span class="line"><span class="function"><span class="params">  state,</span></span></span><br><span class="line"><span class="function"><span class="params">  checkSkip,</span></span></span><br><span class="line"><span class="function"><span class="params">  altGenElement,</span></span></span><br><span class="line"><span class="function"><span class="params">  altGenNode</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> children = el.children;</span><br><span class="line">  <span class="keyword">if</span> (children.length) &#123;</span><br><span class="line">    <span class="keyword">var</span> el$<span class="number">1</span> = children[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// optimize single v-for</span></span><br><span class="line">    <span class="keyword">if</span> (children.length === <span class="number">1</span> &amp;&amp;</span><br><span class="line">      el$<span class="number">1.</span><span class="keyword">for</span> &amp;&amp;</span><br><span class="line">      el$<span class="number">1.</span>tag !== <span class="string">'template'</span> &amp;&amp;</span><br><span class="line">      el$<span class="number">1.</span>tag !== <span class="string">'slot'</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">var</span> normalizationType = checkSkip</span><br><span class="line">        ? state.maybeComponent(el$<span class="number">1</span>) ? <span class="string">",1"</span> : <span class="string">",0"</span></span><br><span class="line">        : <span class="string">""</span>;</span><br><span class="line">      <span class="keyword">return</span> (<span class="string">""</span> + ((altGenElement || genElement)(el$<span class="number">1</span>, state)) + normalizationType)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> normalizationType$<span class="number">1</span> = checkSkip</span><br><span class="line">      ? getNormalizationType(children, state.maybeComponent)</span><br><span class="line">      : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> gen = altGenNode || genNode;</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">"["</span> + (children.map(<span class="function"><span class="keyword">function</span> (<span class="params">c</span>) </span>&#123; <span class="keyword">return</span> gen(c, state); &#125;).join(<span class="string">','</span>)) + <span class="string">"]"</span> + (normalizationType$<span class="number">1</span> ? (<span class="string">","</span> + normalizationType$<span class="number">1</span>) : <span class="string">''</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里遍历子节点数组，进入<code>gen</code>方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genNode</span> (<span class="params">node, state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (node.type === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> genElement(node, state)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.type === <span class="number">3</span> &amp;&amp; node.isComment) &#123;</span><br><span class="line">    <span class="keyword">return</span> genComment(node)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> genText(node)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>又进到<code>genElement</code></p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-232213@2x.png" alt="WX20190906-232213@2x"></p>
<p>这次走到了<code>genData$2</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genData$2</span> (<span class="params">el, state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> data = <span class="string">'&#123;'</span>;</span><br><span class="line">  <span class="keyword">var</span> dirs = genDirectives(el, state);</span><br><span class="line">  <span class="keyword">if</span> (dirs) &#123; data += dirs + <span class="string">','</span>; &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.key) &#123;</span><br><span class="line">    data += <span class="string">"key:"</span> + (el.key) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.ref) &#123;</span><br><span class="line">    data += <span class="string">"ref:"</span> + (el.ref) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.refInFor) &#123;</span><br><span class="line">    data += <span class="string">"refInFor:true,"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.pre) &#123;</span><br><span class="line">    data += <span class="string">"pre:true,"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.component) &#123;</span><br><span class="line">    data += <span class="string">"tag:\""</span> + (el.tag) + <span class="string">"\","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; state.dataGenFns.length; i++) &#123;</span><br><span class="line">    data += state.dataGenFns[i](el);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.attrs) &#123;</span><br><span class="line">    data += <span class="string">"attrs:"</span> + (genProps(el.attrs)) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.props) &#123;</span><br><span class="line">    data += <span class="string">"domProps:"</span> + (genProps(el.props)) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.events) &#123;</span><br><span class="line">    data += (genHandlers(el.events, <span class="literal">false</span>)) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.nativeEvents) &#123;</span><br><span class="line">    data += (genHandlers(el.nativeEvents, <span class="literal">true</span>)) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.slotTarget &amp;&amp; !el.slotScope) &#123;</span><br><span class="line">    data += <span class="string">"slot:"</span> + (el.slotTarget) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.scopedSlots) &#123;</span><br><span class="line">    data += (genScopedSlots(el, el.scopedSlots, state)) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.model) &#123;</span><br><span class="line">    data += <span class="string">"model:&#123;value:"</span> + (el.model.value) + <span class="string">",callback:"</span> + (el.model.callback) + <span class="string">",expression:"</span> + (el.model.expression) + <span class="string">"&#125;,"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.inlineTemplate) &#123;</span><br><span class="line">    <span class="keyword">var</span> inlineTemplate = genInlineTemplate(el, state);</span><br><span class="line">    <span class="keyword">if</span> (inlineTemplate) &#123;</span><br><span class="line">      data += inlineTemplate + <span class="string">","</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  data = data.replace(<span class="regexp">/,$/</span>, <span class="string">''</span>) + <span class="string">'&#125;'</span>;</span><br><span class="line">  <span class="keyword">if</span> (el.dynamicAttrs) &#123;</span><br><span class="line">    data = <span class="string">"_b("</span> + data + <span class="string">",\""</span> + (el.tag) + <span class="string">"\","</span> + (genProps(el.dynamicAttrs)) + <span class="string">")"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.wrapData) &#123;</span><br><span class="line">    data = el.wrapData(data);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.wrapListeners) &#123;</span><br><span class="line">    data = el.wrapListeners(data);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1）声明<code>data</code>初始值为<code>{</code></p>
<p>2）这两个逻辑中，为<code>data</code>拼接事件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (el.events) &#123;</span><br><span class="line">  data += (genHandlers(el.events, <span class="literal">false</span>)) + <span class="string">","</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (el.nativeEvents) &#123;</span><br><span class="line">  data += (genHandlers(el.nativeEvents, <span class="literal">true</span>)) + <span class="string">","</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"&#123;on:&#123;"</span>select<span class="string">":selectHandler&#125;,nativeOn:&#123;"</span>click<span class="string">":function($event)&#123;return clickHandler($event)&#125;&#125;,"</span></span><br></pre></td></tr></table></figure>
<p>3）最后去掉尾巴的逗号</p>
<p>所以最后得到的<code>render</code>方法是这样的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"with(this)&#123;return _c('div',[_c('App',&#123;on:&#123;"</span>select<span class="string">":selectHandler&#125;,nativeOn:&#123;"</span>click<span class="string">":function($event)&#123;return clickHandler($event)&#125;&#125;&#125;)],1)&#125;"</span></span><br></pre></td></tr></table></figure>
<p>看一下生成<code>vnode</code>调用<code>render</code>方法的时候，发现<code>App</code>是个<code>component</code>，不是普通的HTML标签，所以创建组件<code>vnode</code>，下面是创建组件<code>vnode</code>的过程：</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-125550@2x.png" alt="WX20190907-125550@2x"></p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-125619@2x.png" alt="WX20190907-125619@2x"></p>
<p>变量<code>lsteners</code>保存了<code>data.on</code>，并将<code>data.on</code>指向<code>data.nativeOn</code>，然后为组件安装声明周期钩子函数</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-133025@2x.png" alt="WX20190907-133025@2x"></p>
<p>之后创建组件<code>vnode</code>，这就是生成的组件<code>vnode</code></p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-133856@2x.png" alt="WX20190907-133856@2x"></p>
<p>进入<code>update</code>方法，首先是创建<code>div</code>占位符，然后遍历<code>children</code>，创建子节点，就看一下创建组件<code>App</code>的过程，在<code>createComponent</code>的时候，会调用子组件的<code>init</code>钩子方法</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-145809@2x.png" alt="WX20190907-145809@2x"></p>
<p>最后调用<code>child.$mount</code>挂载子组件，在挂载子组件过程中，会先生成子组件<code>vnode</code>，之后再挂载。</p>
<p>挂载之前会为元素添加事件了</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-151133@2x.png" alt="WX20190907-151133@2x"></p>
<p>进入<code>invokeCreateHooks</code>方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invokeCreateHooks</span> (<span class="params">vnode, insertedVnodeQueue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i$<span class="number">1</span> = <span class="number">0</span>; i$<span class="number">1</span> &lt; cbs.create.length; ++i$<span class="number">1</span>) &#123;</span><br><span class="line">    cbs.create[i$<span class="number">1</span>](emptyNode, vnode);</span><br><span class="line">  &#125;</span><br><span class="line">  i = vnode.data.hook; <span class="comment">// Reuse variable</span></span><br><span class="line">  <span class="keyword">if</span> (isDef(i)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isDef(i.create)) &#123; i.create(emptyNode, vnode); &#125;</span><br><span class="line">    <span class="keyword">if</span> (isDef(i.insert)) &#123; insertedVnodeQueue.push(vnode); &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-151217@2x.png" alt="WX20190907-151217@2x"></p>
<p>进入<code>updateDOMListeners</code>方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateDOMListeners</span> (<span class="params">oldVnode, vnode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isUndef(oldVnode.data.on) &amp;&amp; isUndef(vnode.data.on)) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> on = vnode.data.on || &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> oldOn = oldVnode.data.on || &#123;&#125;;</span><br><span class="line">  target$<span class="number">1</span> = vnode.elm;</span><br><span class="line">  normalizeEvents(on);</span><br><span class="line">  updateListeners(on, oldOn, add$<span class="number">1</span>, remove$<span class="number">2</span>, createOnceHandler$<span class="number">1</span>, vnode.context);</span><br><span class="line">  target$<span class="number">1</span> = <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-151354@2x.png" alt="WX20190907-151354@2x"></p>
<p>进入<code>updateListeners</code>方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateListeners</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  on,</span></span></span><br><span class="line"><span class="function"><span class="params">  oldOn,</span></span></span><br><span class="line"><span class="function"><span class="params">  add,</span></span></span><br><span class="line"><span class="function"><span class="params">  remove$$<span class="number">1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  createOnceHandler,</span></span></span><br><span class="line"><span class="function"><span class="params">  vm</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name, def$$<span class="number">1</span>, cur, old, event;</span><br><span class="line">  <span class="keyword">for</span> (name <span class="keyword">in</span> on) &#123;</span><br><span class="line">    def$$<span class="number">1</span> = cur = on[name];</span><br><span class="line">    old = oldOn[name];</span><br><span class="line">    event = normalizeEvent(name);</span><br><span class="line">    <span class="keyword">if</span> (isUndef(cur)) &#123;</span><br><span class="line">      process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; warn(</span><br><span class="line">        <span class="string">"Invalid handler for event \""</span> + (event.name) + <span class="string">"\": got "</span> + <span class="built_in">String</span>(cur),</span><br><span class="line">        vm</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isUndef(old)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isUndef(cur.fns)) &#123;</span><br><span class="line">        cur = on[name] = createFnInvoker(cur, vm);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (isTrue(event.once)) &#123;</span><br><span class="line">        cur = on[name] = createOnceHandler(event.name, cur, event.capture);</span><br><span class="line">      &#125;</span><br><span class="line">      add(event.name, cur, event.capture, event.passive, event.params);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cur !== old) &#123;</span><br><span class="line">      old.fns = cur;</span><br><span class="line">      on[name] = old;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (name <span class="keyword">in</span> oldOn) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isUndef(on[name])) &#123;</span><br><span class="line">      event = normalizeEvent(name);</span><br><span class="line">      remove$$<span class="number">1</span>(event.name, oldOn[name], event.capture);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-151541@2x.png" alt="WX20190907-151541@2x"></p>
<p>进入<code>add</code>方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add$1</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  name,</span></span></span><br><span class="line"><span class="function"><span class="params">  handler,</span></span></span><br><span class="line"><span class="function"><span class="params">  capture,</span></span></span><br><span class="line"><span class="function"><span class="params">  passive</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// async edge case #6566: inner click event triggers patch, event handler</span></span><br><span class="line">  <span class="comment">// attached to outer element during patch, and triggered again. This</span></span><br><span class="line">  <span class="comment">// happens because browsers fire microtask ticks between event propagation.</span></span><br><span class="line">  <span class="comment">// the solution is simple: we save the timestamp when a handler is attached,</span></span><br><span class="line">  <span class="comment">// and the handler would only fire if the event passed to it was fired</span></span><br><span class="line">  <span class="comment">// AFTER it was attached.</span></span><br><span class="line">  <span class="keyword">if</span> (useMicrotaskFix) &#123;</span><br><span class="line">    <span class="keyword">var</span> attachedTimestamp = currentFlushTimestamp;</span><br><span class="line">    <span class="keyword">var</span> original = handler;</span><br><span class="line">    handler = original._wrapper = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        <span class="comment">// no bubbling, should always fire.</span></span><br><span class="line">        <span class="comment">// this is just a safety net in case event.timeStamp is unreliable in</span></span><br><span class="line">        <span class="comment">// certain weird environments...</span></span><br><span class="line">        e.target === e.currentTarget ||</span><br><span class="line">        <span class="comment">// event is fired after handler attachment</span></span><br><span class="line">        e.timeStamp &gt;= attachedTimestamp ||</span><br><span class="line">        <span class="comment">// bail for environments that have buggy event.timeStamp implementations</span></span><br><span class="line">        <span class="comment">// #9462 iOS 9 bug: event.timeStamp is 0 after history.pushState</span></span><br><span class="line">        <span class="comment">// #9681 QtWebEngine event.timeStamp is negative value</span></span><br><span class="line">        e.timeStamp &lt;= <span class="number">0</span> ||</span><br><span class="line">        <span class="comment">// #9448 bail if event is fired in another document in a multi-page</span></span><br><span class="line">        <span class="comment">// electron/nw.js app, since event.timeStamp will be using a different</span></span><br><span class="line">        <span class="comment">// starting reference</span></span><br><span class="line">        e.target.ownerDocument !== <span class="built_in">document</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="keyword">return</span> original.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  target$<span class="number">1.</span>addEventListener(</span><br><span class="line">    name,</span><br><span class="line">    handler,</span><br><span class="line">    supportsPassive</span><br><span class="line">      ? &#123; <span class="attr">capture</span>: capture, <span class="attr">passive</span>: passive &#125;</span><br><span class="line">      : capture</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里为元素添加事件</p>
<p>点击一下触发点击事件</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-165247@2x.png" alt="WX20190907-165247@2x"></p>
<p>走进<code>original.apply(this,arguments)</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invoker</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">arguments</span>$<span class="number">1</span> = <span class="built_in">arguments</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> fns = invoker.fns;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(fns)) &#123;</span><br><span class="line">    <span class="keyword">var</span> cloned = fns.slice();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; cloned.length; i++) &#123;</span><br><span class="line">      invokeWithErrorHandling(cloned[i], <span class="literal">null</span>, <span class="built_in">arguments</span>$<span class="number">1</span>, vm, <span class="string">"v-on handler"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// return handler return value for single handlers</span></span><br><span class="line">    <span class="keyword">return</span> invokeWithErrorHandling(fns, <span class="literal">null</span>, <span class="built_in">arguments</span>, vm, <span class="string">"v-on handler"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>走进<code>invokeWithErrorHandling(fns, null, arguments, vm, &quot;v-on handler&quot;)</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invokeWithErrorHandling</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  handler,</span></span></span><br><span class="line"><span class="function"><span class="params">  context,</span></span></span><br><span class="line"><span class="function"><span class="params">  args,</span></span></span><br><span class="line"><span class="function"><span class="params">  vm,</span></span></span><br><span class="line"><span class="function"><span class="params">  info</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> res;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    res = args ? handler.apply(context, args) : handler.call(context);</span><br><span class="line">    <span class="keyword">if</span> (res &amp;&amp; !res._isVue &amp;&amp; isPromise(res) &amp;&amp; !res._handled) &#123;</span><br><span class="line">      res.catch(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123; <span class="keyword">return</span> handleError(e, vm, info + <span class="string">" (Promise/async)"</span>); &#125;);</span><br><span class="line">      <span class="comment">// issue #9511</span></span><br><span class="line">      <span class="comment">// avoid catch triggering multiple times when nested calls</span></span><br><span class="line">      res._handled = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    handleError(e, vm, info);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>走进<code>handler.apply(context, args)</code></p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-165937@2x.png" alt="WX20190907-165937@2x"></p>
<p>触发<code>App</code>组件的<code>click</code>事件，不过触发之前，先回从<code>_vm</code>上取<code>clickHandler</code>，所以走到了<code>get</code></p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-170314@2x.png" alt="WX20190907-170314@2x"></p>
<p>这里补充一下<code>initMethods</code>方法吧，在初始化调用<code>initState</code>的时候会走进<code>initMethods</code>方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initMethods</span> (<span class="params">vm, methods</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> props = vm.$options.props;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> methods) &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> methods[key] !== <span class="string">'function'</span>) &#123;</span><br><span class="line">        warn(</span><br><span class="line">          <span class="string">"Method \""</span> + key + <span class="string">"\" has type \""</span> + (<span class="keyword">typeof</span> methods[key]) + <span class="string">"\" in the component definition. "</span> +</span><br><span class="line">          <span class="string">"Did you reference the function correctly?"</span>,</span><br><span class="line">          vm</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (props &amp;&amp; hasOwn(props, key)) &#123;</span><br><span class="line">        warn(</span><br><span class="line">          (<span class="string">"Method \""</span> + key + <span class="string">"\" has already been defined as a prop."</span>),</span><br><span class="line">          vm</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ((key <span class="keyword">in</span> vm) &amp;&amp; isReserved(key)) &#123;</span><br><span class="line">        warn(</span><br><span class="line">          <span class="string">"Method \""</span> + key + <span class="string">"\" conflicts with an existing Vue instance method. "</span> +</span><br><span class="line">          <span class="string">"Avoid defining component methods that start with _ or $."</span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    vm[key] = <span class="keyword">typeof</span> methods[key] !== <span class="string">'function'</span> ? noop : bind(methods[key], vm);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个方法，其实就是在<code>vm</code>上添加属性方法（<code>bind(methods[key],vm)</code>返回是个绑定了<code>this</code>方法）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">nativeBind</span> (<span class="params">fn, ctx</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> fn.bind(ctx)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续说触发了<code>App</code>组件<code>click</code>方法</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-171130@2x.png" alt="WX20190907-171130@2x"></p>
<p>先打印出<code>Button clicked,xxxxxx</code>，之后调用<code>this.$emit</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype.$emit = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> lowerCaseEvent = event.toLowerCase();</span><br><span class="line">    <span class="keyword">if</span> (lowerCaseEvent !== event &amp;&amp; vm._events[lowerCaseEvent]) &#123;</span><br><span class="line">      tip(</span><br><span class="line">        <span class="string">"Event \""</span> + lowerCaseEvent + <span class="string">"\" is emitted in component "</span> +</span><br><span class="line">        (formatComponentName(vm)) + <span class="string">" but the handler is registered for \""</span> + event + <span class="string">"\". "</span> +</span><br><span class="line">        <span class="string">"Note that HTML attributes are case-insensitive and you cannot use "</span> +</span><br><span class="line">        <span class="string">"v-on to listen to camelCase events when using in-DOM templates. "</span> +</span><br><span class="line">        <span class="string">"You should probably use \""</span> + (hyphenate(event)) + <span class="string">"\" instead of \""</span> + event + <span class="string">"\"."</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> cbs = vm._events[event];</span><br><span class="line">  <span class="keyword">if</span> (cbs) &#123;</span><br><span class="line">    cbs = cbs.length &gt; <span class="number">1</span> ? toArray(cbs) : cbs;</span><br><span class="line">    <span class="keyword">var</span> args = toArray(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> info = <span class="string">"event handler for \""</span> + event + <span class="string">"\""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, l = cbs.length; i &lt; l; i++) &#123;</span><br><span class="line">      invokeWithErrorHandling(cbs[i], vm, args, vm, info);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>获取<code>vm._events[event]</code>，然后遍历它，调用每一项的方法，那么<code>vm._events</code>在什么时候加的呢？在<code>initEvents(vm);</code>的时候</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initEvents</span> (<span class="params">vm</span>) </span>&#123;</span><br><span class="line">  vm._events = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">  vm._hasHookEvent = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// init parent attached events</span></span><br><span class="line">  <span class="keyword">var</span> listeners = vm.$options._parentListeners;</span><br><span class="line">  <span class="keyword">if</span> (listeners) &#123;</span><br><span class="line">    updateComponentListeners(vm, listeners);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着就是调用<code>selectHandler</code>方法</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-222530@2x.png" alt="WX20190907-222530@2x"></p>
<p>然后冒泡，触发</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-222753@2x.png" alt="WX20190907-222753@2x"></p>
<h3 id="双向绑定原理"><a href="#双向绑定原理" class="headerlink" title="双向绑定原理"></a><strong>双向绑定原理</strong></h3><p>改一下例子</p>
<p>main.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line">Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* eslint-disable no-new */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      message:<span class="string">"123"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">  template: <span class="string">`&lt;div&gt;</span></span><br><span class="line"><span class="string">    &lt;input v-model="message" /&gt;</span></span><br><span class="line"><span class="string">    &#123;&#123;message&#125;&#125;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;`</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>从<code>var code = generate(ast, options);</code>开始</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> createCompiler = createCompilerCreator(<span class="function"><span class="keyword">function</span> <span class="title">baseCompile</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  template,</span></span></span><br><span class="line"><span class="function"><span class="params">  options</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ast = parse(template.trim(), options);</span><br><span class="line">  <span class="keyword">if</span> (options.optimize !== <span class="literal">false</span>) &#123;</span><br><span class="line">    optimize(ast, options);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> code = generate(ast, options);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ast: ast,</span><br><span class="line">    render: code.render,</span><br><span class="line">    staticRenderFns: code.staticRenderFns</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>一直往下走，这是调用栈</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-151714@2x.png" alt="WX20190906-151714@2x"></p>
<p>当<code>el</code>是<code>input</code>的时候</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-151816@2x.png" alt="WX20190906-151816@2x"></p>
<p>走进<code>genData$2</code></p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-152105@2x.png" alt="WX20190906-152105@2x"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genData$2</span> (<span class="params">el, state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> data = <span class="string">'&#123;'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// directives first.</span></span><br><span class="line">  <span class="comment">// directives may mutate the el's other properties before they are generated.</span></span><br><span class="line">  <span class="keyword">var</span> dirs = genDirectives(el, state);</span><br><span class="line">  <span class="keyword">if</span> (dirs) &#123; data += dirs + <span class="string">','</span>; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// key</span></span><br><span class="line">  <span class="keyword">if</span> (el.key) &#123;</span><br><span class="line">    data += <span class="string">"key:"</span> + (el.key) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ref</span></span><br><span class="line">  <span class="keyword">if</span> (el.ref) &#123;</span><br><span class="line">    data += <span class="string">"ref:"</span> + (el.ref) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.refInFor) &#123;</span><br><span class="line">    data += <span class="string">"refInFor:true,"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// pre</span></span><br><span class="line">  <span class="keyword">if</span> (el.pre) &#123;</span><br><span class="line">    data += <span class="string">"pre:true,"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// record original tag name for components using "is" attribute</span></span><br><span class="line">  <span class="keyword">if</span> (el.component) &#123;</span><br><span class="line">    data += <span class="string">"tag:\""</span> + (el.tag) + <span class="string">"\","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// module data generation functions</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; state.dataGenFns.length; i++) &#123;</span><br><span class="line">    data += state.dataGenFns[i](el);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// attributes</span></span><br><span class="line">  <span class="keyword">if</span> (el.attrs) &#123;</span><br><span class="line">    data += <span class="string">"attrs:"</span> + (genProps(el.attrs)) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// DOM props</span></span><br><span class="line">  <span class="keyword">if</span> (el.props) &#123;</span><br><span class="line">    data += <span class="string">"domProps:"</span> + (genProps(el.props)) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// event handlers</span></span><br><span class="line">  <span class="keyword">if</span> (el.events) &#123;</span><br><span class="line">    data += (genHandlers(el.events, <span class="literal">false</span>)) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.nativeEvents) &#123;</span><br><span class="line">    data += (genHandlers(el.nativeEvents, <span class="literal">true</span>)) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// slot target</span></span><br><span class="line">  <span class="comment">// only for non-scoped slots</span></span><br><span class="line">  <span class="keyword">if</span> (el.slotTarget &amp;&amp; !el.slotScope) &#123;</span><br><span class="line">    data += <span class="string">"slot:"</span> + (el.slotTarget) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// scoped slots</span></span><br><span class="line">  <span class="keyword">if</span> (el.scopedSlots) &#123;</span><br><span class="line">    data += (genScopedSlots(el, el.scopedSlots, state)) + <span class="string">","</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// component v-model</span></span><br><span class="line">  <span class="keyword">if</span> (el.model) &#123;</span><br><span class="line">    data += <span class="string">"model:&#123;value:"</span> + (el.model.value) + <span class="string">",callback:"</span> + (el.model.callback) + <span class="string">",expression:"</span> + (el.model.expression) + <span class="string">"&#125;,"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// inline-template</span></span><br><span class="line">  <span class="keyword">if</span> (el.inlineTemplate) &#123;</span><br><span class="line">    <span class="keyword">var</span> inlineTemplate = genInlineTemplate(el, state);</span><br><span class="line">    <span class="keyword">if</span> (inlineTemplate) &#123;</span><br><span class="line">      data += inlineTemplate + <span class="string">","</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  data = data.replace(<span class="regexp">/,$/</span>, <span class="string">''</span>) + <span class="string">'&#125;'</span>;</span><br><span class="line">  <span class="comment">// v-bind dynamic argument wrap</span></span><br><span class="line">  <span class="comment">// v-bind with dynamic arguments must be applied using the same v-bind object</span></span><br><span class="line">  <span class="comment">// merge helper so that class/style/mustUseProp attrs are handled correctly.</span></span><br><span class="line">  <span class="keyword">if</span> (el.dynamicAttrs) &#123;</span><br><span class="line">    data = <span class="string">"_b("</span> + data + <span class="string">",\""</span> + (el.tag) + <span class="string">"\","</span> + (genProps(el.dynamicAttrs)) + <span class="string">")"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// v-bind data wrap</span></span><br><span class="line">  <span class="keyword">if</span> (el.wrapData) &#123;</span><br><span class="line">    data = el.wrapData(data);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// v-on data wrap</span></span><br><span class="line">  <span class="keyword">if</span> (el.wrapListeners) &#123;</span><br><span class="line">    data = el.wrapListeners(data);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>走进<code>var dirs = genDirectives(el, state);</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genDirectives</span> (<span class="params">el, state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> dirs = el.directives;</span><br><span class="line">  <span class="keyword">if</span> (!dirs) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> res = <span class="string">'directives:['</span>;</span><br><span class="line">  <span class="keyword">var</span> hasRuntime = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">var</span> i, l, dir, needRuntime;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>, l = dirs.length; i &lt; l; i++) &#123;</span><br><span class="line">    dir = dirs[i];</span><br><span class="line">    needRuntime = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">var</span> gen = state.directives[dir.name];</span><br><span class="line">    <span class="keyword">if</span> (gen) &#123;</span><br><span class="line">      <span class="comment">// compile-time directive that manipulates AST.</span></span><br><span class="line">      <span class="comment">// returns true if it also needs a runtime counterpart.</span></span><br><span class="line">      needRuntime = !!gen(el, dir, state.warn);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (needRuntime) &#123;</span><br><span class="line">      hasRuntime = <span class="literal">true</span>;</span><br><span class="line">      res += <span class="string">"&#123;name:\""</span> + (dir.name) + <span class="string">"\",rawName:\""</span> + (dir.rawName) + <span class="string">"\""</span> + (dir.value ? (<span class="string">",value:("</span> + (dir.value) + <span class="string">"),expression:"</span> + (<span class="built_in">JSON</span>.stringify(dir.value))) : <span class="string">''</span>) + (dir.arg ? (<span class="string">",arg:"</span> + (dir.isDynamicArg ? dir.arg : (<span class="string">"\""</span> + (dir.arg) + <span class="string">"\""</span>))) : <span class="string">''</span>) + (dir.modifiers ? (<span class="string">",modifiers:"</span> + (<span class="built_in">JSON</span>.stringify(dir.modifiers))) : <span class="string">''</span>) + <span class="string">"&#125;,"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (hasRuntime) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.slice(<span class="number">0</span>, <span class="number">-1</span>) + <span class="string">']'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里遍历了<code>el.directives</code>数组，获取指令对应的<code>gen</code>，走进<code>!!gen(el, dir, state.warn);</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">model</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  el,</span></span></span><br><span class="line"><span class="function"><span class="params">  dir,</span></span></span><br><span class="line"><span class="function"><span class="params">  _warn</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  warn$<span class="number">1</span> = _warn;</span><br><span class="line">  <span class="keyword">var</span> value = dir.value;</span><br><span class="line">  <span class="keyword">var</span> modifiers = dir.modifiers;</span><br><span class="line">  <span class="keyword">var</span> tag = el.tag;</span><br><span class="line">  <span class="keyword">var</span> type = el.attrsMap.type;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    <span class="comment">// inputs with type="file" are read only and setting the input's</span></span><br><span class="line">    <span class="comment">// value will throw an error.</span></span><br><span class="line">    <span class="keyword">if</span> (tag === <span class="string">'input'</span> &amp;&amp; type === <span class="string">'file'</span>) &#123;</span><br><span class="line">      warn$<span class="number">1</span>(</span><br><span class="line">        <span class="string">"&lt;"</span> + (el.tag) + <span class="string">" v-model=\""</span> + value + <span class="string">"\" type=\"file\"&gt;:\n"</span> +</span><br><span class="line">        <span class="string">"File inputs are read only. Use a v-on:change listener instead."</span>,</span><br><span class="line">        el.rawAttrsMap[<span class="string">'v-model'</span>]</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (el.component) &#123;</span><br><span class="line">    genComponentModel(el, value, modifiers);</span><br><span class="line">    <span class="comment">// component v-model doesn't need extra runtime</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tag === <span class="string">'select'</span>) &#123;</span><br><span class="line">    genSelect(el, value, modifiers);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tag === <span class="string">'input'</span> &amp;&amp; type === <span class="string">'checkbox'</span>) &#123;</span><br><span class="line">    genCheckboxModel(el, value, modifiers);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tag === <span class="string">'input'</span> &amp;&amp; type === <span class="string">'radio'</span>) &#123;</span><br><span class="line">    genRadioModel(el, value, modifiers);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tag === <span class="string">'input'</span> || tag === <span class="string">'textarea'</span>) &#123;</span><br><span class="line">    genDefaultModel(el, value, modifiers);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!config.isReservedTag(tag)) &#123;</span><br><span class="line">    genComponentModel(el, value, modifiers);</span><br><span class="line">    <span class="comment">// component v-model doesn't need extra runtime</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    warn$<span class="number">1</span>(</span><br><span class="line">      <span class="string">"&lt;"</span> + (el.tag) + <span class="string">" v-model=\""</span> + value + <span class="string">"\"&gt;: "</span> +</span><br><span class="line">      <span class="string">"v-model is not supported on this element type. "</span> +</span><br><span class="line">      <span class="string">'If you are working with contenteditable, it\'s recommended to '</span> +</span><br><span class="line">      <span class="string">'wrap a library dedicated for that purpose inside a custom component.'</span>,</span><br><span class="line">      el.rawAttrsMap[<span class="string">'v-model'</span>]</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ensure runtime directive metadata</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>走进<code>genDefaultModel(el, value, modifiers);</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genDefaultModel</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  el,</span></span></span><br><span class="line"><span class="function"><span class="params">  value,</span></span></span><br><span class="line"><span class="function"><span class="params">  modifiers</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> type = el.attrsMap.type;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// warn if v-bind:value conflicts with v-model</span></span><br><span class="line">  <span class="comment">// except for inputs with v-bind:type</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> value$<span class="number">1</span> = el.attrsMap[<span class="string">'v-bind:value'</span>] || el.attrsMap[<span class="string">':value'</span>];</span><br><span class="line">    <span class="keyword">var</span> typeBinding = el.attrsMap[<span class="string">'v-bind:type'</span>] || el.attrsMap[<span class="string">':type'</span>];</span><br><span class="line">    <span class="keyword">if</span> (value$<span class="number">1</span> &amp;&amp; !typeBinding) &#123;</span><br><span class="line">      <span class="keyword">var</span> binding = el.attrsMap[<span class="string">'v-bind:value'</span>] ? <span class="string">'v-bind:value'</span> : <span class="string">':value'</span>;</span><br><span class="line">      warn$<span class="number">1</span>(</span><br><span class="line">        binding + <span class="string">"=\""</span> + value$<span class="number">1</span> + <span class="string">"\" conflicts with v-model on the same element "</span> +</span><br><span class="line">        <span class="string">'because the latter already expands to a value binding internally'</span>,</span><br><span class="line">        el.rawAttrsMap[binding]</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> ref = modifiers || &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> lazy = ref.lazy;</span><br><span class="line">  <span class="keyword">var</span> number = ref.number;</span><br><span class="line">  <span class="keyword">var</span> trim = ref.trim;</span><br><span class="line">  <span class="keyword">var</span> needCompositionGuard = !lazy &amp;&amp; type !== <span class="string">'range'</span>;</span><br><span class="line">  <span class="keyword">var</span> event = lazy</span><br><span class="line">    ? <span class="string">'change'</span></span><br><span class="line">    : type === <span class="string">'range'</span></span><br><span class="line">      ? RANGE_TOKEN</span><br><span class="line">      : <span class="string">'input'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> valueExpression = <span class="string">'$event.target.value'</span>;</span><br><span class="line">  <span class="keyword">if</span> (trim) &#123;</span><br><span class="line">    valueExpression = <span class="string">"$event.target.value.trim()"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (number) &#123;</span><br><span class="line">    valueExpression = <span class="string">"_n("</span> + valueExpression + <span class="string">")"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> code = genAssignmentCode(value, valueExpression);</span><br><span class="line">  <span class="keyword">if</span> (needCompositionGuard) &#123;</span><br><span class="line">    code = <span class="string">"if($event.target.composing)return;"</span> + code;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addProp(el, <span class="string">'value'</span>, (<span class="string">"("</span> + value + <span class="string">")"</span>));</span><br><span class="line">  addHandler(el, event, code, <span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">if</span> (trim || number) &#123;</span><br><span class="line">    addHandler(el, <span class="string">'blur'</span>, <span class="string">'$forceUpdate()'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">addProp(el, <span class="string">'value'</span>, (<span class="string">"("</span> + value + <span class="string">")"</span>));</span><br><span class="line">addHandler(el, event, code, <span class="literal">null</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>其中的这两个方法，给 <code>el</code> 添加一个 <code>prop</code>，相当于我们在 <code>input</code> 上动态绑定了 <code>value</code>，又给 <code>el</code> 添加了事件处理，相当于在 <code>input</code> 上绑定了 <code>input</code> 事件</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-161250@2x.png" alt="WX20190906-161250@2x"></p>
<p>然后上面<code>var dirs = genDirectives(el, state);</code>返回的<code>dirs</code>就是这样的</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-161533@2x.png" alt="WX20190906-161533@2x"></p>
<p>最终获得的<code>render</code>方法是这样的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"with(this)&#123;return _c('div',[_c('input',&#123;directives:[&#123;name:"</span>model<span class="string">",rawName:"</span>v-model<span class="string">",value:(message),expression:"</span>message<span class="string">"&#125;],domProps:&#123;"</span>value<span class="string">":(message)&#125;,on:&#123;"</span>input<span class="string">":function($event)&#123;if($event.target.composing)return;message=$event.target.value&#125;&#125;&#125;),_v("</span>\n    <span class="string">"+_s(message)+"</span>\n  <span class="string">")])&#125;"</span></span><br></pre></td></tr></table></figure>
<p>往后走到调用<code>render</code>方法的地方</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-165558@2x.png" alt="WX20190906-165558@2x"></p>
<p>顺便补充一下这个<code>vm._renderProxy</code>，其实就是<code>new Proxy(vm,handlers)</code>返回的实例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">initProxy = <span class="function"><span class="keyword">function</span> <span class="title">initProxy</span> (<span class="params">vm</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (hasProxy) &#123;</span><br><span class="line">    <span class="comment">// determine which proxy handler to use</span></span><br><span class="line">    <span class="keyword">var</span> options = vm.$options;</span><br><span class="line">    <span class="keyword">var</span> handlers = options.render &amp;&amp; options.render._withStripped</span><br><span class="line">      ? getHandler</span><br><span class="line">      : hasHandler;</span><br><span class="line">    vm._renderProxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(vm, handlers);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    vm._renderProxy = vm;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这个是<code>input</code>生成的<code>vnode</code></p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-171617@2x.png" alt="WX20190906-171617@2x"></p>
<p>走进去<code>update</code>方法看下<code>patch</code>阶段做了什么，进入<code>createElm</code>方法里的<code>createChildren</code>方法（这里是创建的是<code>div</code>标签的<code>children</code>）</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-174914@2x.png" alt="WX20190906-174914@2x"></p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-172113@2x.png" alt="WX20190906-172113@2x"></p>
<p>又会走到<code>createElm</code>，这里是<code>input</code>标签的了</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-175418@2x.png" alt="WX20190906-175418@2x"></p>
<p>进入<code>invokeCreateHooks</code>方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">invokeCreateHooks</span> (<span class="params">vnode, insertedVnodeQueue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i$<span class="number">1</span> = <span class="number">0</span>; i$<span class="number">1</span> &lt; cbs.create.length; ++i$<span class="number">1</span>) &#123;</span><br><span class="line">    cbs.create[i$<span class="number">1</span>](emptyNode, vnode);</span><br><span class="line">  &#125;</span><br><span class="line">  i = vnode.data.hook; <span class="comment">// Reuse variable</span></span><br><span class="line">  <span class="keyword">if</span> (isDef(i)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isDef(i.create)) &#123; i.create(emptyNode, vnode); &#125;</span><br><span class="line">    <span class="keyword">if</span> (isDef(i.insert)) &#123; insertedVnodeQueue.push(vnode); &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-180033@2x.png" alt="WX20190906-180033@2x"></p>
<p><code>updateDOMListeners</code>方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateDOMListeners</span> (<span class="params">oldVnode, vnode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isUndef(oldVnode.data.on) &amp;&amp; isUndef(vnode.data.on)) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> on = vnode.data.on || &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> oldOn = oldVnode.data.on || &#123;&#125;;</span><br><span class="line">  target$<span class="number">1</span> = vnode.elm;</span><br><span class="line">  normalizeEvents(on);</span><br><span class="line">  updateListeners(on, oldOn, add$<span class="number">1</span>, remove$<span class="number">2</span>, createOnceHandler$<span class="number">1</span>, vnode.context);</span><br><span class="line">  target$<span class="number">1</span> = <span class="literal">undefined</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>走进<code>updateListeners</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateListeners</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  on,</span></span></span><br><span class="line"><span class="function"><span class="params">  oldOn,</span></span></span><br><span class="line"><span class="function"><span class="params">  add,</span></span></span><br><span class="line"><span class="function"><span class="params">  remove$$<span class="number">1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  createOnceHandler,</span></span></span><br><span class="line"><span class="function"><span class="params">  vm</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name, def$$<span class="number">1</span>, cur, old, event;</span><br><span class="line">  <span class="keyword">for</span> (name <span class="keyword">in</span> on) &#123;</span><br><span class="line">    def$$<span class="number">1</span> = cur = on[name];</span><br><span class="line">    old = oldOn[name];</span><br><span class="line">    event = normalizeEvent(name);</span><br><span class="line">    <span class="keyword">if</span> (isUndef(cur)) &#123;</span><br><span class="line">      process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; warn(</span><br><span class="line">        <span class="string">"Invalid handler for event \""</span> + (event.name) + <span class="string">"\": got "</span> + <span class="built_in">String</span>(cur),</span><br><span class="line">        vm</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isUndef(old)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isUndef(cur.fns)) &#123;</span><br><span class="line">        cur = on[name] = createFnInvoker(cur, vm);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (isTrue(event.once)) &#123;</span><br><span class="line">        cur = on[name] = createOnceHandler(event.name, cur, event.capture);</span><br><span class="line">      &#125;</span><br><span class="line">      add(event.name, cur, event.capture, event.passive, event.params);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cur !== old) &#123;</span><br><span class="line">      old.fns = cur;</span><br><span class="line">      on[name] = old;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (name <span class="keyword">in</span> oldOn) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isUndef(on[name])) &#123;</span><br><span class="line">      event = normalizeEvent(name);</span><br><span class="line">      remove$$<span class="number">1</span>(event.name, oldOn[name], event.capture);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>走进<code>add(event.name, cur, event.capture, event.passive, event.params);</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add$1</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  name,</span></span></span><br><span class="line"><span class="function"><span class="params">  handler,</span></span></span><br><span class="line"><span class="function"><span class="params">  capture,</span></span></span><br><span class="line"><span class="function"><span class="params">  passive</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (useMicrotaskFix) &#123;</span><br><span class="line">    <span class="keyword">var</span> attachedTimestamp = currentFlushTimestamp;</span><br><span class="line">    <span class="keyword">var</span> original = handler;</span><br><span class="line">    handler = original._wrapper = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        e.target === e.currentTarget ||</span><br><span class="line">        e.timeStamp &gt;= attachedTimestamp ||</span><br><span class="line">        e.timeStamp &lt;= <span class="number">0</span> ||</span><br><span class="line">        e.target.ownerDocument !== <span class="built_in">document</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="keyword">return</span> original.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  target$<span class="number">1.</span>addEventListener(</span><br><span class="line">    name,</span><br><span class="line">    handler,</span><br><span class="line">    supportsPassive</span><br><span class="line">      ? &#123; <span class="attr">capture</span>: capture, <span class="attr">passive</span>: passive &#125;</span><br><span class="line">      : capture</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里添加绑定事件</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-185324@2x.png" alt="WX20190906-185324@2x"></p>
<p>触发一下绑定<code>input</code>事件</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-185653@2x.png" alt="WX20190906-185653@2x"></p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-185841@2x.png" alt="WX20190906-185841@2x"></p>
<p>就是调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">$event</span>)</span>&#123;<span class="keyword">if</span>($event.target.composing)<span class="keyword">return</span>;message=$event.target.value&#125;</span><br></pre></td></tr></table></figure>
<p>然后又触发<code>setter</code></p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190906-190059@2x.png" alt="WX20190906-190059@2x"></p>
<p>后面就不写了</p>
<p><strong>总的来说就是</strong></p>
<p>1）在模板解析，生成<code>render</code>方法的时候，为<code>input</code>的<code>el</code>先添加了<code>events</code>属性，之后又判断有<code>events</code>属性的话，生成的<code>data</code>做字符串拼接(最后拼接到<code>render</code>方法里的字符串)</p>
<p><img src="ttp://www.qinhanwen.xyz/WX20190907-123004@2x.png" alt="WX20190907-123004@2x"></p>
<p>2）在调用<code>render</code>方法生成<code>vnode</code>以后，在<code>update</code>的<code>patch</code>阶段，为DOM元素增加事件</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Vue源码解析/" rel="tag"># Vue源码解析</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/09/08/Vue源码解析（6）-路由/" rel="next" title="Vue源码解析（6）- 路由">
                <i class="fa fa-chevron-left"></i> Vue源码解析（6）- 路由
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="秦瀚文" />
          <p class="site-author-name" itemprop="name">秦瀚文</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/index.html">
                <span class="site-state-item-count">107</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#补充"><span class="nav-number">1.</span> <span class="nav-text">补充</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#事件"><span class="nav-number">1.1.</span> <span class="nav-text">事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#双向绑定原理"><span class="nav-number">1.2.</span> <span class="nav-text">双向绑定原理</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">秦瀚文</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
